/*!
 * s-flux.js v0.0.1
 * (c) 2016 Season Chen
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.sFlux=t.sFlux||{})}(this,function(t){"use strict";function e(t){if(c)throw new Error("store has been registed, if you want regist another store, first call unregister() !");c=t}function i(){c=null}function n(t){if(!c)throw new Error("must first call `registerStore` tp register the store before call dispatch an action !");return c.dispatch(t)}function r(t,e){return function(){var i;return i=e.apply(void 0,arguments),new Promise(function(e,r){"object"==typeof i&&null!==i&&"function"==typeof i.then?i.then(function(i){n({type:t,data:i}),e()})["catch"](r):(n({type:t,data:i}),e())})}}function o(t,e){this._callbacks=[],this._isDispatching=!1,this._state=t,this._reducer=e}function s(t,e){var i;if("object"!=typeof t)throw new Error("the first argument `initialState` must be a pure object !");if("function"!=typeof e)throw new Error("the second argument `reducer` must be a pure function !");return i=new o(t,e)}var c;o.prototype={getState:function(){return this._state},dispatch:function(t){var e,i;if(this._isDispatching)throw new Error("can not dispatch in the middle of another dispatch !");this._isDispatching=!0,e=this.getState(),i=this._reducer(e,t),this._state=this._immutable(i),this.emitChange(),this._isDispatching=!1,e=i=null},_immutable:function(t){return t},emitChange:function(){this._callbacks.forEach(function(t){t()})},subscribe:function(t){var e=this._callbacks,i=e.indexOf(t),n=!0;if(-1!=i)throw new Error("the callback function has been subscribed !");return e.push(t),function(){var i;n&&(i=e.indexOf(t),e.splice(i,1),n=!1)}}},t.registerStore=e,t.unregisterStore=i,t.createAction=r,t.createStore=s});